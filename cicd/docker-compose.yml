version: '3'

services:
    jenkins:
        user: root
        image: 192.168.0.11:5000/api-jenkins:latest
        ports:
         - "8082:8080"
         - "50000:50000"
        volumes:
         - /var/run/docker.sock:/var/run/docker.sock
         - /volumenes/vol_jenkins:/var/jenkins_home
        environment:
         - JENKINS_ADMIN_ID=admin
         - JENKINS_ADMIN_PASSWORD=admin
        deploy:
            mode: replicated
            replicas: 1
            placement:
                constraints:
                 - "node.role==manager"
    registry:
        image: registry:latest
        ports:
         - "5000:5000"
    #nexus:
    #    image: "sonatype/nexus3"
    #    ports:
    #     - "8083:8081"
    #    volumes:
    #     - /opt/docker/cicd/vol_nexus:/nexus-data sonatype/nexus3
    gitlab:
        image: 'gitlab/gitlab-ee:latest'
        restart: always
        hostname: 'gitlab.example.com'
        environment:
            GITLAB_OMNIBUS_CONFIG: |
                external_url 'http://192.168.0.20:8929'
                gitlab_rails['gitlab_shell_ssh_port'] = 2224
        ports:
         - '8929:8929'
         - '2224:22'
        volumes:
         - '/volumenes/vol_gitlab/config:/etc/gitlab'
         - '/volumenes/vol_gitlab/logs:/var/log/gitlab'
         - '/volumenes/vol_gitlab/data:/var/opt/gitlab'
        deploy:
            mode: replicated
            replicas: 1
            placement:
                constraints:
                 - "node.role==manager"
    #sonar:
    #    image: 'sonarqube'
    #    ports:
    #     - '9000:9000'
    #     - '9092:9092'

